#! /usr/bin/env python
# -*- coding: utf-8 -*-

"""Append the Entrust Intermediate L1K certificate to certifi certs.
Certifi uses the Mozilla CA bundle which only has Entrust's root
certificate. Some of the federation sites, like federate.xh1.lilly.com:9032,
are missing the intermediate chain and Mozilla does not include it. This is
a patch to add the intermediate so we can complete the chain for SSL
verification."""

from __future__ import print_function
import os
import certifi


def get_ca_cert(certs):
    """
    Append the missing intermediate to a certifi bundle (Mozilla CA Bundle)
    and return the new bundle's path.

    :param cert_to_add: the path to the certificate to append to the
      certifi/Mozilla bundle.
    :return: path to new CA cert.
    """
    with open(certifi.where(), 'r') as file_handle:
        existing_certs = file_handle.read()

    new_ca_cert = (os.path.join(os.path.dirname(__file__), 'cacert.pem'))
    with open(new_ca_cert, 'w') as ca_cert:
        ca_cert.write(existing_certs)
        for cert in certs:
            with open(os.path.join(os.path.dirname(__file__), cert), 'r') as file_handle:
                additional_cert = file_handle.read()
                ca_cert.write(additional_cert)

    return new_ca_cert
